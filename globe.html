<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SENTINEL GLOBE</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #020408;
    overflow: hidden;
    font-family: 'Courier New', monospace;
    color: #58a6ff;
    user-select: none;
  }
  #canvas-container {
    position: relative;
    width: 100vw;
    height: 100vh;
  }
  canvas { display: block; }

  /* Scanline overlay */
  #scanlines {
    position: fixed; inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.03) 2px,
      rgba(0,0,0,0.03) 4px
    );
    pointer-events: none;
    z-index: 10;
  }

  /* CRT vignette */
  #vignette {
    position: fixed; inset: 0;
    background: radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.7) 100%);
    pointer-events: none;
    z-index: 9;
  }

  /* Header */
  #header {
    position: fixed; top: 0; left: 0; right: 0;
    padding: 12px 20px;
    display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(180deg, rgba(2,4,8,0.95) 0%, transparent 100%);
    z-index: 20;
  }
  #header-left { display: flex; align-items: center; gap: 16px; }
  #logo {
    font-size: 18px; font-weight: bold; letter-spacing: 6px;
    color: #58a6ff;
    text-shadow: 0 0 20px rgba(88,166,255,0.8);
  }
  #subtitle { font-size: 9px; letter-spacing: 3px; color: #374151; }
  #header-right { font-size: 10px; color: #374151; letter-spacing: 1px; }
  #clock { color: #58a6ff; }

  /* Status bar */
  #statusbar {
    position: fixed; bottom: 0; left: 0; right: 0;
    padding: 8px 20px;
    display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(0deg, rgba(2,4,8,0.98) 0%, transparent 100%);
    z-index: 20;
    font-size: 9px; letter-spacing: 1px; color: #374151;
  }
  .status-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 5px; }
  .dot-active { background: #3fb950; box-shadow: 0 0 6px #3fb950; animation: pulse-dot 2s infinite; }
  .dot-warn   { background: #e3b341; box-shadow: 0 0 6px #e3b341; }
  .dot-alert  { background: #f85149; box-shadow: 0 0 6px #f85149; animation: pulse-dot 1s infinite; }
  @keyframes pulse-dot { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* Threat panel â€” right side */
  #threat-panel {
    position: fixed; right: 16px; top: 60px;
    width: 220px;
    background: rgba(2,4,8,0.9);
    border: 1px solid #1f2937;
    border-right: none;
    z-index: 20;
  }
  .panel-header {
    padding: 6px 10px;
    font-size: 9px; letter-spacing: 2px; color: #58a6ff;
    border-bottom: 1px solid #1f2937;
    background: rgba(88,166,255,0.04);
  }
  .threat-item {
    padding: 8px 10px;
    border-bottom: 1px solid #0d1117;
    cursor: pointer;
    transition: background 0.15s;
  }
  .threat-item:hover { background: rgba(88,166,255,0.06); }
  .threat-name { font-size: 10px; color: #c9d1d9; font-weight: bold; }
  .threat-status { font-size: 9px; margin-top: 2px; }
  .t-critical { color: #f85149; }
  .t-elevated { color: #e3b341; }
  .t-watch    { color: #58a6ff; }

  /* Info card â€” appears on hover/click */
  #info-card {
    position: fixed;
    background: rgba(2,4,8,0.96);
    border: 1px solid #1f2937;
    border-left: 3px solid #58a6ff;
    padding: 14px 16px;
    width: 300px;
    z-index: 30;
    display: none;
    pointer-events: none;
    backdrop-filter: blur(8px);
  }
  #info-card.show { display: block; }
  #info-card.critical { border-left-color: #f85149; }
  #info-card.elevated { border-left-color: #e3b341; }
  .ic-label { font-size: 9px; letter-spacing: 2px; color: #374151; margin-bottom: 4px; }
  .ic-title { font-size: 13px; font-weight: bold; color: #c9d1d9; margin-bottom: 6px; }
  .ic-body  { font-size: 10px; color: #8b949e; line-height: 1.6; }
  .ic-tags  { margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap; }
  .ic-tag   { font-size: 9px; padding: 2px 6px; border: 1px solid #1f2937; color: #374151; }

  /* Coordinates */
  #coords {
    position: fixed; bottom: 32px; left: 20px;
    font-size: 9px; color: #1f2937; letter-spacing: 1px;
    z-index: 20;
  }

  /* Search / filter */
  #filter-bar {
    position: fixed; left: 16px; top: 60px;
    z-index: 20;
    display: flex; flex-direction: column; gap: 4px;
  }
  .filter-btn {
    background: rgba(2,4,8,0.9);
    border: 1px solid #1f2937;
    color: #8b949e;
    font-family: 'Courier New', monospace;
    font-size: 9px; letter-spacing: 1px;
    padding: 5px 10px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: left;
  }
  .filter-btn:hover, .filter-btn.active {
    background: rgba(88,166,255,0.08);
    border-color: #58a6ff;
    color: #58a6ff;
  }

  /* Live feed ticker */
  #ticker {
    position: fixed; bottom: 26px; left: 0; right: 0;
    overflow: hidden; height: 18px;
    background: rgba(2,4,8,0.6);
    z-index: 20;
  }
  #ticker-inner {
    display: flex; gap: 60px;
    animation: scroll-ticker 60s linear infinite;
    white-space: nowrap;
    font-size: 9px; letter-spacing: 1px; color: #374151;
    padding: 2px 0;
  }
  @keyframes scroll-ticker {
    0%   { transform: translateX(100vw); }
    100% { transform: translateX(-100%); }
  }
  .ticker-item { display: inline-flex; align-items: center; gap: 8px; }
  .ticker-sep  { color: #1f2937; }
</style>
</head>
<body>

<div id="scanlines"></div>
<div id="vignette"></div>

<!-- Header -->
<div id="header">
  <div id="header-left">
    <div>
      <div id="logo">âš¡ SENTINEL</div>
      <div id="subtitle">GEOPOLITICAL INTELLIGENCE LAYER v2.0</div>
    </div>
    <div style="font-size:9px;color:#1f2937">
      <span class="status-dot dot-active"></span>GDELT LIVE &nbsp;
      <span class="status-dot dot-active"></span>AIS FEED &nbsp;
      <span class="status-dot dot-warn"></span>OSINT
    </div>
  </div>
  <div id="header-right">
    <div id="clock"></div>
    <div style="margin-top:2px">LAT <span id="lat-disp">0.000Â°</span> &nbsp; LON <span id="lon-disp">0.000Â°</span></div>
  </div>
</div>

<!-- Filter bar -->
<div id="filter-bar">
  <div class="filter-btn active" data-filter="all">â—‰ ALL EVENTS</div>
  <div class="filter-btn" data-filter="conflict">â—ˆ CONFLICT</div>
  <div class="filter-btn" data-filter="energy">â—ˆ ENERGY / OIL</div>
  <div class="filter-btn" data-filter="shipping">â—ˆ SHIPPING</div>
  <div class="filter-btn" data-filter="minerals">â—ˆ MINERALS</div>
  <div class="filter-btn" data-filter="trade">â—ˆ TRADE / TECH</div>
</div>

<!-- Threat panel -->
<div id="threat-panel">
  <div class="panel-header">â–¶ ACTIVE THEATERS</div>
  <div class="threat-item" data-lat="31" data-lon="35">
    <div class="threat-name">MIDDLE EAST</div>
    <div class="threat-status t-critical">â— CRITICAL â€” Iran / Gaza / Houthi</div>
  </div>
  <div class="threat-item" data-lat="25" data-lon="121">
    <div class="threat-name">TAIWAN STRAIT</div>
    <div class="threat-status t-elevated">â—‰ ELEVATED â€” PLA exercises</div>
  </div>
  <div class="threat-item" data-lat="49" data-lon="32">
    <div class="threat-name">UKRAINE FRONT</div>
    <div class="threat-status t-critical">â— CRITICAL â€” Active conflict</div>
  </div>
  <div class="threat-item" data-lat="13" data-lon="2">
    <div class="threat-name">SAHEL / AFRICA</div>
    <div class="threat-status t-elevated">â—‰ ELEVATED â€” Coup activity</div>
  </div>
  <div class="threat-item" data-lat="12.5" data-lon="43.5">
    <div class="threat-name">RED SEA / SUEZ</div>
    <div class="threat-status t-critical">â— CRITICAL â€” Houthi attacks</div>
  </div>
  <div class="threat-item" data-lat="10" data-lon="115">
    <div class="threat-name">SOUTH CHINA SEA</div>
    <div class="threat-status t-elevated">â—‰ ELEVATED â€” Territorial dispute</div>
  </div>
  <div class="threat-item" data-lat="26.5" data-lon="54">
    <div class="threat-name">STRAIT OF HORMUZ</div>
    <div class="threat-status t-elevated">â—‰ ELEVATED â€” Iran naval</div>
  </div>
</div>

<!-- Info card -->
<div id="info-card">
  <div class="ic-label" id="ic-label">EVENT</div>
  <div class="ic-title" id="ic-title">â€”</div>
  <div class="ic-body"  id="ic-body">â€”</div>
  <div class="ic-tags"  id="ic-tags"></div>
</div>

<!-- Coordinates display -->
<div id="coords">
  <span id="coord-text">DRAG TO ROTATE &nbsp;|&nbsp; SCROLL TO ZOOM &nbsp;|&nbsp; CLICK MARKERS FOR INTEL</span>
</div>

<!-- Live ticker -->
<div id="ticker">
  <div id="ticker-inner">
    <span class="ticker-item"><span class="t-critical">â—</span> RED SEA: 3 vessel incidents past 7 days â€” Houthi activity elevated â€” shipping rates +18%</span>
    <span class="ticker-sep">///</span>
    <span class="ticker-item"><span class="t-elevated">â—‰</span> TAIWAN: PLA conducts naval exercises 80nm east of Taiwan â€” TSMC operations unaffected</span>
    <span class="ticker-sep">///</span>
    <span class="ticker-item"><span class="t-critical">â—</span> UKRAINE: Frontline stable â€” EU announces new energy independence package</span>
    <span class="ticker-sep">///</span>
    <span class="ticker-item"><span class="t-elevated">â—‰</span> HORMUZ: IRGC intercepts merchant vessel â€” Lloyd's war risk premium elevated</span>
    <span class="ticker-sep">///</span>
    <span class="ticker-item"><span class="t-elevated">â—‰</span> SAHEL: Mali coup government extends China mining rights â€” cobalt supply chain watch</span>
    <span class="ticker-sep">///</span>
    <span class="ticker-item">SENTINEL GEO LAYER â€” GDELT LIVE FEED â€” CONFIDENCE: MEDIUM â€” VERIFY WITH PRIMARY SOURCES</span>
  </div>
</div>

<!-- Status bar -->
<div id="statusbar">
  <div>
    <span class="status-dot dot-active"></span>SENTINEL ONLINE &nbsp;&nbsp;
    <span class="status-dot dot-alert"></span>3 CRITICAL ALERTS &nbsp;&nbsp;
    <span class="status-dot dot-warn"></span>4 ELEVATED WARNINGS
  </div>
  <div>SOURCES: GDELT â€¢ AIS HUB â€¢ OPENSKY â€¢ NEWSAPI â€¢ OSINT</div>
  <div>âš  RESEARCH ONLY â€” NOT FINANCIAL ADVICE â€” VERIFY BEFORE ACTING</div>
</div>

<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// â”€â”€ SCENE SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const W = window.innerWidth, H = window.innerHeight;
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setSize(W, H);
document.body.appendChild(renderer.domElement);
renderer.domElement.style.cssText = 'position:fixed;inset:0;z-index:1';

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, W / H, 0.1, 1000);
camera.position.z = 2.8;

// â”€â”€ LIGHTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ambientLight = new THREE.AmbientLight(0x112244, 0.8);
scene.add(ambientLight);
const sunLight = new THREE.DirectionalLight(0x4488ff, 1.2);
sunLight.position.set(5, 3, 5);
scene.add(sunLight);
const rimLight = new THREE.DirectionalLight(0x001133, 0.5);
rimLight.position.set(-5, -2, -2);
scene.add(rimLight);

// â”€â”€ STARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const starGeo = new THREE.BufferGeometry();
const starCount = 4000;
const starPos = new Float32Array(starCount * 3);
for (let i = 0; i < starCount * 3; i++) starPos[i] = (Math.random() - 0.5) * 500;
starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0x334466, size: 0.4 }));
scene.add(stars);

// â”€â”€ EARTH GLOBE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const globeRadius = 1.0;
const globeGeo = new THREE.SphereGeometry(globeRadius, 64, 64);

// Procedural canvas texture â€” dark ocean, land visible
function makeEarthTexture() {
  const c = document.createElement('canvas');
  c.width = 2048; c.height = 1024;
  const ctx = c.getContext('2d');

  // Ocean â€” deep dark blue
  ctx.fillStyle = '#020c1b';
  ctx.fillRect(0, 0, c.width, c.height);

  // Grid lines â€” subtle
  ctx.strokeStyle = 'rgba(30,60,100,0.25)';
  ctx.lineWidth = 0.5;
  for (let lon = -180; lon <= 180; lon += 30) {
    const x = (lon + 180) / 360 * c.width;
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, c.height); ctx.stroke();
  }
  for (let lat = -90; lat <= 90; lat += 30) {
    const y = (90 - lat) / 180 * c.height;
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(c.width, y); ctx.stroke();
  }

  // Land masses (simplified polygons)
  const lands = [
    // North America
    [[0.04,0.12],[0.18,0.10],[0.22,0.22],[0.25,0.35],[0.20,0.50],[0.15,0.55],[0.10,0.52],[0.06,0.42],[0.04,0.30]],
    // South America
    [[0.19,0.52],[0.25,0.50],[0.28,0.58],[0.27,0.72],[0.22,0.82],[0.17,0.78],[0.16,0.68],[0.18,0.58]],
    // Europe
    [[0.46,0.18],[0.54,0.16],[0.58,0.20],[0.56,0.28],[0.50,0.32],[0.46,0.30],[0.44,0.24]],
    // Africa
    [[0.46,0.32],[0.56,0.30],[0.60,0.38],[0.58,0.58],[0.54,0.72],[0.48,0.74],[0.44,0.68],[0.42,0.50],[0.44,0.38]],
    // Asia
    [[0.56,0.16],[0.72,0.14],[0.82,0.18],[0.88,0.28],[0.85,0.38],[0.78,0.44],[0.68,0.46],[0.60,0.38],[0.56,0.28]],
    // Australia
    [[0.78,0.60],[0.88,0.58],[0.92,0.64],[0.90,0.72],[0.84,0.76],[0.78,0.72],[0.76,0.66]],
    // Russia
    [[0.56,0.14],[0.80,0.10],[0.90,0.14],[0.88,0.22],[0.72,0.24],[0.58,0.22]],
    // Greenland
    [[0.22,0.05],[0.32,0.04],[0.34,0.12],[0.28,0.16],[0.20,0.14]],
  ];

  lands.forEach(pts => {
    ctx.beginPath();
    pts.forEach(([x, y], i) => {
      const px = x * c.width, py = y * c.height;
      i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
    });
    ctx.closePath();
    ctx.fillStyle = '#0a1f0f';
    ctx.fill();
    ctx.strokeStyle = 'rgba(30,90,50,0.4)';
    ctx.lineWidth = 1;
    ctx.stroke();
  });

  // Atmosphere glow on edges
  const grad = ctx.createRadialGradient(c.width/2, c.height/2, c.height*0.35,
                                         c.width/2, c.height/2, c.height*0.52);
  grad.addColorStop(0, 'transparent');
  grad.addColorStop(1, 'rgba(0,20,60,0.3)');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, c.width, c.height);

  return new THREE.CanvasTexture(c);
}

const earthMat = new THREE.MeshPhongMaterial({
  map: makeEarthTexture(),
  shininess: 15,
  specular: new THREE.Color(0x112233),
  emissive: new THREE.Color(0x000a15),
  emissiveIntensity: 0.3
});
const earth = new THREE.Mesh(globeGeo, earthMat);
scene.add(earth);

// â”€â”€ ATMOSPHERE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const atmGeo = new THREE.SphereGeometry(1.04, 64, 64);
const atmMat = new THREE.MeshPhongMaterial({
  color: 0x0033aa,
  transparent: true,
  opacity: 0.07,
  side: THREE.FrontSide
});
scene.add(new THREE.Mesh(atmGeo, atmMat));

// Outer glow
const glowGeo = new THREE.SphereGeometry(1.12, 32, 32);
const glowMat = new THREE.MeshBasicMaterial({
  color: 0x001155,
  transparent: true,
  opacity: 0.04,
  side: THREE.BackSide
});
scene.add(new THREE.Mesh(glowGeo, glowMat));

// â”€â”€ GRID OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const wireGeo = new THREE.SphereGeometry(1.005, 36, 18);
const wireMat = new THREE.MeshBasicMaterial({
  color: 0x0d2040,
  wireframe: true,
  transparent: true,
  opacity: 0.15
});
scene.add(new THREE.Mesh(wireGeo, wireMat));

// â”€â”€ HOTSPOT DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HOTSPOTS = [
  {
    lat: 31.5, lon: 34.8, label: 'GAZA / ISRAEL',
    severity: 'critical', type: 'conflict',
    title: 'Gaza â€” Active Conflict Zone',
    body: 'Ongoing military operations. Civilian infrastructure severely degraded. Significant humanitarian crisis. Regional escalation risk involves Hezbollah (Lebanon), Iran-backed proxies.',
    tags: ['OIL RISK', 'REGIONAL ESCALATION', 'HUMANITARIAN'],
    market: 'WTI Crude, XLE, ITA (Defense)'
  },
  {
    lat: 15.6, lon: 44.0, label: 'RED SEA / HOUTHI',
    severity: 'critical', type: 'shipping',
    title: 'Red Sea â€” Houthi Shipping Attacks',
    body: 'Houthi forces (Yemen) attacking commercial vessels transiting Red Sea/Suez corridor. Vessels rerouting around Cape of Good Hope (+10-14 day voyage). Container rates elevated.',
    tags: ['SHIPPING DISRUPTION', 'INFLATION INPUT', 'OIL TANKERS'],
    market: 'Container rates, XLE, airline stocks, European inflation'
  },
  {
    lat: 26.5, lon: 56.0, label: 'STRAIT OF HORMUZ',
    severity: 'elevated', type: 'energy',
    title: 'Strait of Hormuz â€” Iranian Naval Presence',
    body: 'IRGC maintaining elevated naval presence. ~20% of global oil transits this chokepoint. Any closure or incident triggers immediate spike in WTI/Brent. Lloyd\'s war risk premium elevated.',
    tags: ['20% GLOBAL OIL', 'IRAN RISK', 'TANKER ROUTE'],
    market: 'WTI Crude, Brent, XLE, airline margins'
  },
  {
    lat: 25.0, lon: 121.5, label: 'TAIWAN STRAIT',
    severity: 'elevated', type: 'trade',
    title: 'Taiwan Strait â€” PLA Military Posture',
    body: 'People\'s Liberation Army conducting regular naval and air exercises near Taiwan. TSMC produces ~90% of world\'s advanced chips. Any blockade = global semiconductor shock. US carrier groups present.',
    tags: ['TSMC RISK', 'SEMICONDUCTOR SUPPLY', 'CONFLICT RISK'],
    market: 'SMH, NVDA, AAPL supply chain, SOXX'
  },
  {
    lat: 49.0, lon: 31.0, label: 'UKRAINE FRONT',
    severity: 'critical', type: 'conflict',
    title: 'Ukraine â€” Active War Theater',
    body: 'Frontline relatively stable but active. Russia targeting energy infrastructure. European energy dependency declining but not eliminated. Ukrainian grain corridor under periodic threat. NATO posture elevated.',
    tags: ['NATURAL GAS', 'GRAIN SUPPLY', 'NATO POSTURE'],
    market: 'Natural gas (NG=F), wheat futures, European banks, defense ETF (ITA)'
  },
  {
    lat: 14.0, lon: 2.0, label: 'SAHEL / MALI',
    severity: 'elevated', type: 'minerals',
    title: 'Sahel â€” Coup Activity & Critical Minerals',
    body: 'Multiple coup governments across Mali, Niger, Burkina Faso. Chinese interests expanding â€” BRI infrastructure, mining rights. Gold mining (Mali is top-5 African producer) and new lithium exploration deals.',
    tags: ['GOLD MINING', 'LITHIUM', 'COBALT', 'CHINA INFLUENCE'],
    market: 'GDX (gold miners), SIL (silver), lithium ETF (LIT)'
  },
  {
    lat: -5.0, lon: 23.5, label: 'DRC â€” COBALT',
    severity: 'elevated', type: 'minerals',
    title: 'DRC â€” Cobalt Supply Chain',
    body: 'Democratic Republic of Congo produces ~70% of world\'s cobalt â€” critical for EV batteries. Ongoing conflict in eastern DRC threatens mining operations. China controls most refining capacity. ESG pressure on supply chain.',
    tags: ['70% GLOBAL COBALT', 'EV BATTERIES', 'CHINA REFINING'],
    market: 'Cobalt ETF, TSLA supply chain, battery manufacturers, LIT'
  },
  {
    lat: 14.0, lon: 120.0, label: 'SOUTH CHINA SEA',
    severity: 'elevated', type: 'shipping',
    title: 'South China Sea â€” Territorial Disputes',
    body: '$3T+ in annual trade transits this waterway. China asserting territorial control over international waters. Philippines-China confrontations escalating at Second Thomas Shoal. US naval presence active.',
    tags: ['$3T TRADE ROUTE', 'NAVAL TENSIONS', 'TERRITORIAL DISPUTE'],
    market: 'Container shipping, semiconductors, Southeast Asian FX'
  },
  {
    lat: 56.0, lon: 37.6, label: 'RUSSIA ENERGY',
    severity: 'elevated', type: 'energy',
    title: 'Russia â€” Energy Export Rerouting',
    body: 'Russian oil/gas rerouted to Asia (China, India) after Western sanctions. European energy independence improving but LNG costs remain elevated. Russian Arctic LNG projects face equipment sanctions.',
    tags: ['LNG PRICES', 'SANCTIONS', 'CHINA-RUSSIA TRADE'],
    market: 'European natgas, LNG tanker stocks, UNG'
  },
  {
    lat: 55.0, lon: 105.0, label: 'MONGOLIA â€” RARE EARTH',
    severity: 'watch', type: 'minerals',
    title: 'Central Asia â€” Critical Mineral Race',
    body: 'US, EU, China racing to secure rare earth mineral access across Central Asia. Mongolia, Kazakhstan emerging as strategic targets. New mining agreements being negotiated to reduce China REE dominance.',
    tags: ['RARE EARTHS', 'STRATEGIC MINERALS', 'CHINA COMPETITION'],
    market: 'MP Materials (MP), rare earth ETF, defense contractors'
  },
  {
    lat: -20.0, lon: 28.0, label: 'ZIMBABWE â€” LITHIUM',
    severity: 'watch', type: 'minerals',
    title: 'Zimbabwe â€” Lithium Export Controls',
    body: 'Zimbabwe imposed raw lithium ore export ban â€” forcing value-added processing domestically. Chinese companies dominate local processing. Key EV battery supply chain node with growing strategic importance.',
    tags: ['LITHIUM', 'EV BATTERIES', 'EXPORT BAN'],
    market: 'LIT (lithium ETF), ALB (Albemarle), SQM'
  },
  {
    lat: 35.6, lon: 139.7, label: 'JAPAN â€” BOJ POLICY',
    severity: 'watch', type: 'trade',
    title: 'Japan â€” BOJ Rate Policy & Yen Dynamics',
    body: 'Bank of Japan normalizing ultra-loose monetary policy. Yen carry trade unwinding risk â€” trillions in positions. JPY strength = global market volatility event. Watch USD/JPY 145-150 range closely.',
    tags: ['YEN CARRY TRADE', 'BOJ POLICY', 'GLOBAL VOLATILITY'],
    market: 'USD/JPY, Nikkei, DXY, global bond markets'
  },
];

// â”€â”€ LAT/LON â†’ 3D â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function latLonToVec3(lat, lon, r = 1.0) {
  const phi   = (90 - lat) * Math.PI / 180;
  const theta = (lon + 180) * Math.PI / 180;
  return new THREE.Vector3(
    -r * Math.sin(phi) * Math.cos(theta),
     r * Math.cos(phi),
     r * Math.sin(phi) * Math.sin(theta)
  );
}

// â”€â”€ MARKER CREATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLORS = { critical: 0xf85149, elevated: 0xe3b341, watch: 0x58a6ff, default: 0x3fb950 };
const markerGroup = new THREE.Group();
scene.add(markerGroup);

const markers = [];

HOTSPOTS.forEach(hs => {
  const color = COLORS[hs.severity] || COLORS.default;
  const pos = latLonToVec3(hs.lat, hs.lon, 1.01);

  // Outer ring pulse
  const ringGeo = new THREE.RingGeometry(0.020, 0.028, 32);
  const ringMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.6, side: THREE.DoubleSide });
  const ring = new THREE.Mesh(ringGeo, ringMat);
  ring.position.copy(pos);
  ring.lookAt(pos.clone().multiplyScalar(2));
  markerGroup.add(ring);

  // Core dot
  const dotGeo = new THREE.SphereGeometry(0.012, 8, 8);
  const dotMat = new THREE.MeshBasicMaterial({ color });
  const dot = new THREE.Mesh(dotGeo, dotMat);
  dot.position.copy(pos);
  markerGroup.add(dot);

  // Spike
  const spikeGeo = new THREE.CylinderGeometry(0.001, 0.001, 0.06, 4);
  const spikeMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.4 });
  const spike = new THREE.Mesh(spikeGeo, spikeMat);
  spike.position.copy(pos.clone().multiplyScalar(1.03));
  spike.lookAt(pos.clone().multiplyScalar(3));
  spike.rotateX(Math.PI / 2);
  markerGroup.add(spike);

  markers.push({ dot, ring, ringMat, dotMat, data: hs, pos, phase: Math.random() * Math.PI * 2 });
});

// â”€â”€ RAYCASTING (CLICK / HOVER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const raycaster = new THREE.Raycaster();
raycaster.params.Points = { threshold: 0.05 };
const mouse = new THREE.Vector2(-999, -999);
let activeMarker = null;

const infoCard = document.getElementById('info-card');
const icTitle  = document.getElementById('ic-title');
const icBody   = document.getElementById('ic-body');
const icLabel  = document.getElementById('ic-label');
const icTags   = document.getElementById('ic-tags');

function showCard(marker, x, y) {
  const d = marker.data;
  icLabel.textContent = `${d.type.toUpperCase()} Â· ${d.severity.toUpperCase()} Â· ${d.lat.toFixed(1)}Â°N ${d.lon.toFixed(1)}Â°E`;
  icTitle.textContent = d.title;
  icBody.innerHTML = d.body + (d.market ? `<br><br><span style="color:#58a6ff">ğŸ“Š Market exposure: ${d.market}</span>` : '');
  icTags.innerHTML = (d.tags || []).map(t => `<span class="ic-tag">${t}</span>`).join('');
  infoCard.className = `show ${d.severity}`;

  // Position card smartly
  const cx = Math.min(x + 16, window.innerWidth - 320);
  const cy = Math.min(y - 10, window.innerHeight - 200);
  infoCard.style.left = cx + 'px';
  infoCard.style.top  = cy + 'px';
}

function hideCard() {
  infoCard.className = '';
  activeMarker = null;
}

document.addEventListener('mousemove', e => {
  mouse.x =  (e.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
  lastMouseX = e.clientX;
  lastMouseY = e.clientY;

  // Update coordinate display
  document.getElementById('lat-disp').textContent = (mouse.y * 90).toFixed(3) + 'Â°';
  document.getElementById('lon-disp').textContent = (mouse.x * 180).toFixed(3) + 'Â°';
});

document.addEventListener('click', e => {
  mouse.x =  (e.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);

  const dotMeshes = markers.map(m => m.dot);
  const intersects = raycaster.intersectObjects(dotMeshes);

  if (intersects.length > 0) {
    const idx = dotMeshes.indexOf(intersects[0].object);
    activeMarker = markers[idx];
    showCard(activeMarker, e.clientX, e.clientY);
  } else {
    hideCard();
  }
});

// Threat panel clicks
document.querySelectorAll('.threat-item').forEach(el => {
  el.addEventListener('click', () => {
    const lat = parseFloat(el.dataset.lat);
    const lon = parseFloat(el.dataset.lon);
    const targetVec = latLonToVec3(lat, lon, 1.0).normalize();
    targetLat = lat; targetLon = lon;
  });
});

// Filter buttons
let activeFilter = 'all';
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.dataset.filter;

    markers.forEach(m => {
      const show = activeFilter === 'all' || m.data.type === activeFilter;
      m.dot.visible   = show;
      m.ring.visible  = show;
    });
  });
});

// â”€â”€ DRAG ROTATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let isDragging = false, prevX = 0, prevY = 0;
let rotX = 0, rotY = 0;
let velX = 0, velY = 0;
let lastMouseX = 0, lastMouseY = 0;
let autoRotate = true;
let targetLat = null, targetLon = null;

document.addEventListener('mousedown', e => {
  if (e.target === renderer.domElement) {
    isDragging = true; autoRotate = false;
    prevX = e.clientX; prevY = e.clientY;
    velX = 0; velY = 0;
  }
});
document.addEventListener('mouseup', () => { isDragging = false; });
document.addEventListener('mousemove', e => {
  if (!isDragging) return;
  const dx = e.clientX - prevX;
  const dy = e.clientY - prevY;
  velX = dx * 0.003;
  velY = dy * 0.003;
  rotY += dx * 0.003;
  rotX += dy * 0.003;
  rotX = Math.max(-Math.PI/2, Math.min(Math.PI/2, rotX));
  prevX = e.clientX; prevY = e.clientY;
});

// Zoom
let camZ = 2.8;
document.addEventListener('wheel', e => {
  camZ += e.deltaY * 0.002;
  camZ = Math.max(1.5, Math.min(5.0, camZ));
});

// Touch
let lastTX = 0, lastTY = 0;
document.addEventListener('touchstart', e => {
  isDragging = true; autoRotate = false;
  lastTX = e.touches[0].clientX;
  lastTY = e.touches[0].clientY;
});
document.addEventListener('touchend', () => { isDragging = false; });
document.addEventListener('touchmove', e => {
  if (!isDragging) return;
  const dx = e.touches[0].clientX - lastTX;
  const dy = e.touches[0].clientY - lastTY;
  rotY += dx * 0.004; rotX += dy * 0.004;
  lastTX = e.touches[0].clientX;
  lastTY = e.touches[0].clientY;
  e.preventDefault();
}, { passive: false });

// â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateClock() {
  const now = new Date();
  const pst = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
  const pad = n => String(n).padStart(2, '0');
  document.getElementById('clock').textContent =
    `${pad(pst.getHours())}:${pad(pst.getMinutes())}:${pad(pst.getSeconds())} PST`;
}
setInterval(updateClock, 1000);
updateClock();

// â”€â”€ ANIMATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let t = 0;
function animate() {
  requestAnimationFrame(animate);
  t += 0.016;

  // Auto-rotate
  if (autoRotate) {
    rotY += 0.0018;
  } else if (!isDragging) {
    velX *= 0.92; velY *= 0.92;
    rotY += velX;
    rotX += velY;
    if (Math.abs(velX) < 0.0001 && Math.abs(velY) < 0.0001) {
      setTimeout(() => { autoRotate = true; }, 4000);
    }
  }
  rotX = Math.max(-Math.PI/2, Math.min(Math.PI/2, rotX));

  // Apply rotation
  earth.rotation.x = rotX;
  earth.rotation.y = rotY;
  markerGroup.rotation.x = rotX;
  markerGroup.rotation.y = rotY;

  // Animate markers
  markers.forEach(m => {
    const scale = 1.0 + 0.35 * Math.sin(t * 2.5 + m.phase);
    m.ring.scale.setScalar(scale);
    m.ringMat.opacity = 0.3 + 0.4 * (1 - (scale - 1) / 0.35);

    // Critical markers pulse faster
    if (m.data.severity === 'critical') {
      const urgentScale = 1.0 + 0.5 * Math.abs(Math.sin(t * 4 + m.phase));
      m.ring.scale.setScalar(urgentScale);
    }
  });

  // Hover detection
  raycaster.setFromCamera(mouse, camera);
  const dotMeshes = markers.map(m => m.dot);
  const intersects = raycaster.intersectObjects(dotMeshes);
  document.body.style.cursor = intersects.length > 0 ? 'crosshair' : 'grab';
  if (intersects.length > 0) {
    const idx = dotMeshes.indexOf(intersects[0].object);
    if (!activeMarker) showCard(markers[idx], lastMouseX, lastMouseY);
  }

  // Smooth zoom
  camera.position.z += (camZ - camera.position.z) * 0.08;

  renderer.render(scene, camera);
}
animate();

// â”€â”€ RESIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('resize', () => {
  const W = window.innerWidth, H = window.innerHeight;
  renderer.setSize(W, H);
  camera.aspect = W / H;
  camera.updateProjectionMatrix();
});
</script>
</body>
</html>

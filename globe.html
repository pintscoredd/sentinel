<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SENTINEL GLOBE</title>
<style>
  body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
  gmp-map-3d { width: 100%; height: 100%; }
  
  #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
  #scanlines { position: absolute; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.05) 2px, rgba(0,0,0,0.05) 4px); pointer-events: none; }
  #vignette { position: absolute; inset: 0; background: radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.8) 100%); pointer-events: none; }

  #threat-panel {
    position: absolute; right: 16px; top: 16px; width: 220px;
    background: rgba(5,5,5,0.85); border: 1px solid #333; pointer-events: auto;
  }
  .panel-header { padding: 6px 10px; font-size: 10px; color: #FF9900; border-bottom: 1px solid #333; font-weight: bold; }
  .threat-item { padding: 8px 10px; border-bottom: 1px solid #222; cursor: pointer; }
  .threat-item:hover { background: rgba(255,153,0,0.1); }
  .threat-name { font-size: 11px; color: #C0C0C0; font-weight: bold; }
  .threat-status { font-size: 10px; margin-top: 2px; }
  .t-critical { color: #FF0000; }
  .t-elevated { color: #FF9900; }
  .t-watch { color: #00FF00; }

  #info-card {
    position: absolute; background: rgba(0,0,0,0.95); border: 1px solid #333; border-left: 3px solid #FF9900;
    padding: 14px 16px; width: 300px; display: none; pointer-events: auto; z-index: 20;
  }
  #info-card.show { display: block; }
  .ic-label { font-size: 10px; color: #FF9900; margin-bottom: 4px; font-weight: bold; }
  .ic-title { font-size: 13px; font-weight: bold; color: #FFF; margin-bottom: 6px; }
  .ic-body  { font-size: 11px; color: #C0C0C0; line-height: 1.4; }
  
  #filter-bar { position: absolute; left: 16px; top: 16px; display: flex; flex-direction: column; gap: 4px; pointer-events: auto; }
  .filter-btn {
    background: rgba(5,5,5,0.85); border: 1px solid #333; color: #C0C0C0;
    font-family: 'Courier New', monospace; font-size: 10px; padding: 5px 10px; cursor: pointer; text-align: left;
  }
  .filter-btn:hover, .filter-btn.active { border-color: #FF9900; color: #FF9900; }
</style>
<script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY&v=alpha&libraries=maps3d"></script>
</head>
<body>

<gmp-map-3d id="map3d" center="25,45,15000000" tilt="0" heading="0" mode="SATELLITE"></gmp-map-3d>

<div id="ui-layer">
  <div id="scanlines"></div>
  <div id="vignette"></div>

  <div id="filter-bar">
    <div class="filter-btn active" data-filter="all">◉ ALL EVENTS</div>
    <div class="filter-btn" data-filter="conflict">◈ CONFLICT</div>
    <div class="filter-btn" data-filter="energy">◈ ENERGY / OIL</div>
    <div class="filter-btn" data-filter="shipping">◈ SHIPPING</div>
    <div class="filter-btn" data-filter="minerals">◈ MINERALS</div>
  </div>

  <div id="threat-panel">
    <div class="panel-header">▶ ACTIVE THEATERS</div>
    <div id="threat-list"></div>
  </div>

  <div id="info-card">
    <div class="ic-label" id="ic-label">EVENT</div>
    <div class="ic-title" id="ic-title">—</div>
    <div class="ic-body"  id="ic-body">—</div>
  </div>
</div>

<script>
// Streamlit will dynamically overwrite this array
const HOTSPOTS = /*INJECT_HOTSPOTS*/ [];

let map3D;
let markers = [];

async function initMap() {
  await customElements.whenDefined('gmp-map-3d');
  map3D = document.querySelector('gmp-map-3d');
  const { Marker3DElement } = await google.maps.importLibrary("maps3d");
  
  const threatList = document.getElementById('threat-list');

  HOTSPOTS.forEach(hs => {
    // Add Marker
    const marker = new Marker3DElement({ position: { lat: hs.lat, lng: hs.lon, altitude: 0 }, extruded: true, label: hs.title });
    marker.addEventListener('gmp-click', () => { flyTo(hs.lat, hs.lon, 200000, 45); showInfoCard(hs); });
    map3D.appendChild(marker);
    markers.push({ element: marker, data: hs });

    // Populate Sidebar Threat Panel
    const threatItem = document.createElement('div');
    threatItem.className = 'threat-item';
    threatItem.innerHTML = `
      <div class="threat-name">${hs.title.toUpperCase()}</div>
      <div class="threat-status ${hs.severity === 'critical' ? 't-critical' : 't-elevated'}">
        ● ${hs.severity.toUpperCase()} — ${hs.type}
      </div>
    `;
    threatItem.addEventListener('click', () => flyTo(hs.lat, hs.lon, 500000, 45));
    threatList.appendChild(threatItem);
  });

  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const filter = btn.dataset.filter;
      markers.forEach(m => { m.element.style.display = (filter === 'all' || m.data.type === filter) ? 'block' : 'none'; });
    });
  });
}

function flyTo(lat, lng, altitude, tilt) {
  map3D.flyCameraTo({ endCamera: { center: { lat, lng, altitude }, tilt: tilt, heading: 0 }, durationMillis: 2000 });
}

const infoCard = document.getElementById('info-card');
function showInfoCard(data) {
  document.getElementById('ic-label').textContent = `${data.type.toUpperCase()} · ${data.lat}°N ${data.lon}°E`;
  document.getElementById('ic-title').textContent = data.title;
  document.getElementById('ic-body').innerHTML = data.body;
  
  infoCard.className = 'show';
  infoCard.style.left = '50px';
  infoCard.style.bottom = '50px';
  infoCard.style.top = 'auto';
  setTimeout(() => { infoCard.className = ''; }, 6000);
}

document.addEventListener('mousedown', (e) => { if(e.target === map3D) { infoCard.className = ''; } });
initMap();
</script>
</body>
</html>
